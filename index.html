<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Movie Website</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff8c00;
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --text-color: #e0e0e0;
            --font-family: 'Roboto', sans-serif;
        }
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            font-size: 16px;
        }

        /* --- Loader --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--background-color); display: flex; justify-content: center;
            align-items: center; z-index: 9999;
        }
        .spinner {
            border: 6px solid #f3f3f330; border-top: 6px solid var(--primary-color);
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Header --- */
        header {
            background-color: var(--surface-color); padding: 15px 20px;
            display: flex; align-items: center; gap: 20px;
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            flex-wrap: wrap;
        }
        .site-title {
            font-size: 1.5rem; font-weight: 700; color: var(--primary-color); margin: 0;
        }
        .search-bar {
            flex-grow: 1; display: flex;
        }
        .search-bar input {
            width: 100%; padding: 10px 15px; border-radius: 20px;
            border: 1px solid #444; background-color: #2a2a2a; color: #fff;
            font-size: 1rem;
        }
        .app-download-btn {
            display: none; padding: 8px 15px; background-color: var(--primary-color);
            color: #111; text-decoration: none; border-radius: 20px;
            font-weight: 700; transition: background-color 0.2s;
        }
        .app-download-btn:hover { background-color: #ffac4d; }

        /* --- Main Content --- */
        main { padding: 20px; }
        #message-bar {
            background-color: #ff8c0022; border: 1px solid var(--primary-color);
            padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;
        }
        #category-filters {
            display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px;
        }
        .filter-btn {
            padding: 8px 18px; border: 1px solid #555; background: none; color: var(--text-color);
            border-radius: 20px; cursor: pointer; white-space: nowrap; transition: all 0.2s;
        }
        .filter-btn.active, .filter-btn:hover {
            background-color: var(--primary-color); color: #111; border-color: var(--primary-color);
        }

        /* --- Movie Grid & Cards --- */
        #movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }
        .movie-card {
            background-color: var(--surface-color); border-radius: 8px; overflow: hidden;
            cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        }
        .movie-card:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.4); }
        .movie-card img {
            width: 100%; display: block; aspect-ratio: 2 / 3; object-fit: cover;
        }
        .movie-card h3 {
            font-size: 1rem; padding: 10px; margin: 0; white-space: nowrap;
            overflow: hidden; text-overflow: ellipsis; text-align: center;
        }

        /* --- Movie Detail Modal --- */
        #movie-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1001; display: none;
            justify-content: center; align-items: center; padding: 20px;
            box-sizing: border-box;
        }
        .modal-content {
            background-color: var(--surface-color); border-radius: 12px;
            max-width: 800px; width: 100%; max-height: 90vh;
            display: flex;
            padding: 20px; overflow-y: auto;
            position: relative;
        }
        .modal-close {
            position: absolute; top: 15px; right: 20px; font-size: 2rem;
            color: #aaa; cursor: pointer; line-height: 1; z-index: 10;
        }
        
        /* --- New styles for Modal --- */
        .modal-content {
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 0; /* Remove default gap */
        }
        .modal-poster img {
            max-width: 280px;
            width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .modal-title-custom {
            color: #f5c518; /* Yellow color like screenshot */
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .modal-links-custom {
            display: flex;
            flex-direction: column;
            width: 90%;
            max-width: 400px;
            gap: 12px;
            margin-bottom: 25px;
        }
        .modal-link-btn {
            padding: 12px 20px;
            color: #ffffff;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 700;
            text-align: center;
            font-size: 1.1rem;
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        .modal-link-btn.watch-now { background-color: #d90429; }
        .modal-link-btn.watch-360p { background-color: #2b9348; }
        .modal-link-btn.watch-720p { background-color: #0077b6; }

        /* --- Info Table styling --- */
        .info-table {
            width: 90%;
            max-width: 400px;
            margin-bottom: 25px;
            padding: 10px 0;
        }
        .info-row {
            display: flex;
            justify-content: flex-start;
            padding: 8px 5px;
            text-align: left;
            border-bottom: 1px solid #2a2a2a;
        }
        .info-row:last-child { border-bottom: none; }
        .info-label {
            color: #f5c518;
            font-weight: 500;
            width: 120px;
            flex-shrink: 0;
        }
        
        /* --- Banner Ad Container Styling --- */
        #modal-ad-banner-container {
            width: 90%;
            max-width: 400px;
            margin-bottom: 20px; /* বিজ্ঞাপন এবং ডেসক্রিপশনের মধ্যে ফাঁকা জায়গা */
            min-height: 50px;    /* বিজ্ঞাপনের কোড লোড হওয়ার আগে যেনো লেআউট নষ্ট না হয় */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- Description Section --- */
        .description-section {
            width: 90%;
            max-width: 400px;
            text-align: left;
        }
        .description-title {
            color: #e0e0e0;
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #modal-description {
            line-height: 1.6;
            color: #ccc;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 600px) {
            header { flex-direction: column; }
            .modal-poster img { max-width: 220px; }
        }
    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div></div>

    <header>
        <h1 class="site-title">My Movies</h1>
        <div class="search-bar">
            <input type="search" id="search-input" placeholder="Search for a movie...">
        </div>
        <a href="#" id="app-download-btn" class="app-download-btn" target="_blank">Download App</a>
    </header>

    <main>
        <div id="message-bar" style="display: none;"></div>
        <div id="category-filters"></div>
        <div id="movie-grid"></div>
    </main>

    <!-- UPDATED Movie Detail Modal -->
    <div id="movie-modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>

            <div class="modal-poster">
                <img id="modal-img" src="" alt="Movie Poster">
            </div>

            <h2 id="modal-title" class="modal-title-custom"></h2>

            <div id="modal-links" class="modal-links-custom"></div>

            <div class="info-table">
                <div class="info-row">
                    <span class="info-label">Director</span>
                    <span id="modal-director"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Genre</span>
                    <span id="modal-category"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Cast</span>
                    <span id="modal-cast"></span>
                </div>
                 <div class="info-row">
                    <span class="info-label">Release Date</span>
                    <span id="modal-release-date"></span>
                </div>
            </div>

            <!-- ################################################## -->
            <!-- ########## BANNER AD HAS BEEN PLACED HERE ######## -->
            <!-- ################################################## -->
            <div id="modal-ad-banner-container">
<script type="text/javascript">
	atOptions = {
		'key' : 'ca89ce47317b6a13d35e3c7e04813e6a',
		'format' : 'iframe',
		'height' : 250,
		'width' : 300,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/ca89ce47317b6a13d35e3c7e04813e6a/invoke.js"></script>
            </div>
            <!-- ################# END BANNER AD ################## -->


            <div class="description-section">
                <h3 class="description-title">DESCRIPTION</h3>
                <p id="modal-description"></p>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyD-tlrPK8s9h87PVqtvprBy_phcCqONLeU",
            authDomain: "my-movie-81a4b.firebaseapp.com",
            databaseURL: "https://my-movie-81a4b-default-rtdb.firebaseio.com",
            projectId: "my-movie-81a4b",
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const moviesRef = database.ref('movies');
        const settingsRef = database.ref('siteSettings');
        const analyticsRef = database.ref('analytics/visits');

        // --- DOM Elements ---
        const loader = document.getElementById('loader');
        const movieGrid = document.getElementById('movie-grid');
        const categoryFilters = document.getElementById('category-filters');
        const searchInput = document.getElementById('search-input');
        const modal = document.getElementById('movie-modal');

        let allMovies = []; // To store all movies locally

        // --- Main Functions on Page Load ---
        document.addEventListener('DOMContentLoaded', () => {
            logVisit();
            loadSiteSettings();
            loadMovies();
        });
        
        function logVisit() {
            analyticsRef.push({
                timestamp: Date.now(),
                referrer: document.referrer
            }).catch(error => console.error("Analytics error:", error));
        }

        function loadSiteSettings() {
            settingsRef.once('value', snapshot => {
                const settings = snapshot.val();
                if (!settings) return;

                const appBtn = document.getElementById('app-download-btn');
                if (settings.appDownloadUrl) {
                    appBtn.href = settings.appDownloadUrl;
                    appBtn.style.display = 'inline-block';
                }

                const messageBar = document.getElementById('message-bar');
                const userLang = (navigator.language || navigator.userLanguage).slice(0, 2);
                let message = settings.bengaliMessage;
                if (userLang === 'hi' && settings.hindiMessage) {
                    message = settings.hindiMessage;
                }
                if (message) {
                    messageBar.textContent = message;
                    messageBar.style.display = 'block';
                }
            });
        }
        
        function loadMovies() {
            loader.style.display = 'flex';
            moviesRef.orderByChild('timestamp').once('value', snapshot => {
                const moviesData = snapshot.val();
                if (moviesData) {
                    allMovies = Object.entries(moviesData).map(([key, value]) => ({ key, ...value })).reverse();
                    displayMovies(allMovies);
                    populateCategories();
                }
                loader.style.display = 'none';
            });
        }

        function displayMovies(movies) {
            movieGrid.innerHTML = '';
            if (movies.length === 0) {
                movieGrid.innerHTML = '<p>No movies found.</p>';
                return;
            }
            movies.forEach(movie => {
                const card = document.createElement('div');
                card.className = 'movie-card';
                card.innerHTML = `<img src="${movie.image}" alt="${movie.title}" loading="lazy"><h3>${movie.title}</h3>`;
                card.onclick = () => openModal(movie);
                movieGrid.appendChild(card);
            });
        }

        function populateCategories() {
            const categories = ['All', ...new Set(allMovies.map(m => m.category))];
            categoryFilters.innerHTML = '';
            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.textContent = category;
                if (category === 'All') {
                    btn.classList.add('active');
                }
                btn.onclick = () => filterByCategory(category, btn);
                categoryFilters.appendChild(btn);
            });
        }

        function filterByCategory(category, clickedBtn) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            clickedBtn.classList.add('active');
            const filteredMovies = category === 'All' ? allMovies : allMovies.filter(movie => movie.category === category);
            displayMovies(filteredMovies);
        }
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredMovies = allMovies.filter(movie => 
                movie.title.toLowerCase().includes(searchTerm)
            );
            displayMovies(filteredMovies);
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.filter-btn').classList.add('active');
        });

        function openModal(movie) {
            const releaseYear = movie.releaseDate ? ` (${movie.releaseDate.substring(0, 4)})` : '';
            document.getElementById('modal-title').textContent = movie.title + releaseYear;
            document.getElementById('modal-img').src = movie.image;
            document.getElementById('modal-category').textContent = movie.category || 'N/A';
            document.getElementById('modal-description').textContent = movie.description || 'No description available.';
            document.getElementById('modal-director').textContent = movie.director || 'N/A';
            document.getElementById('modal-cast').textContent = movie.cast || 'N/A';
            document.getElementById('modal-release-date').textContent = movie.releaseDate || 'N/A';

            const linksContainer = document.getElementById('modal-links');
            linksContainer.innerHTML = '';
            if (movie.link) {
                linksContainer.innerHTML += `<a href="${movie.link}" class="modal-link-btn watch-now" target="_blank">▶ Watch Now</a>`;
            }
            if (movie.link3) {
                linksContainer.innerHTML += `<a href="${movie.link3}" class="modal-link-btn watch-360p" target="_blank">Watch 360p</a>`;
            }
            if (movie.link2) {
                linksContainer.innerHTML += `<a href="${movie.link2}" class="modal-link-btn watch-720p" target="_blank">Watch 720p</a>`;
            }
            
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
        }
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });
    </script>
</body>
    </html>
